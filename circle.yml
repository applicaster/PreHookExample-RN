machine:
  node:
    version: 8.1.4
  post:
    - npm i -g npm
    - npm i -g react-native@0.47.1

test:
  override:
    - mkdir -p $CIRCLE_TEST_REPORTS/junit
    - npm run test-reporter
    - npm run jest
    - cp test-results.xml $CIRCLE_TEST_REPORTS/junit
    - cp jest-results.xml $CIRCLE_TEST_REPORTS/junit

deployment:
  production:
    branch: production
    commands:
    - mkdir -R /tmp/build/ios
    - mkdir -R /tmp/build/android
    - npm run build-circle
    - npm run deploy-circle

  development:
    branch: master
    commands:
      - mkdir -R /tmp/build/ios
      - mkdir -R /tmp/build/android
      - npm run build-circle
      - npm run stage-circle